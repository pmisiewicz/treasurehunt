(function(){"use strict";const tt=Math.sqrt(3),ot=.5*(tt-1),W=(3-tt)/6,rt=1/3,G=1/6,Y=n=>Math.floor(n)|0,et=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),Q=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function st(n=Math.random){const t=nt(n),e=new Float64Array(t).map(s=>et[s%12*2]),o=new Float64Array(t).map(s=>et[s%12*2+1]);return function(y,c){let k=0,r=0,w=0;const g=(y+c)*ot,x=Y(y+g),v=Y(c+g),C=(x+v)*W,R=x-C,T=v-C,D=y-R,h=c-T;let L,A;D>h?(L=1,A=0):(L=0,A=1);const O=D-L+W,u=h-A+W,l=D-1+2*W,m=h-1+2*W,p=x&255,M=v&255;let q=.5-D*D-h*h;if(q>=0){const i=p+t[M],_=e[i],E=o[i];q*=q,k=q*q*(_*D+E*h)}let d=.5-O*O-u*u;if(d>=0){const i=p+L+t[M+A],_=e[i],E=o[i];d*=d,r=d*d*(_*O+E*u)}let f=.5-l*l-m*m;if(f>=0){const i=p+1+t[M+1],_=e[i],E=o[i];f*=f,w=f*f*(_*l+E*m)}return 70*(k+r+w)}}function it(n=Math.random){const t=nt(n),e=new Float64Array(t).map(y=>Q[y%12*3]),o=new Float64Array(t).map(y=>Q[y%12*3+1]),s=new Float64Array(t).map(y=>Q[y%12*3+2]);return function(c,k,r){let w,g,x,v;const C=(c+k+r)*rt,R=Y(c+C),T=Y(k+C),D=Y(r+C),h=(R+T+D)*G,L=R-h,A=T-h,O=D-h,u=c-L,l=k-A,m=r-O;let p,M,q,d,f,i;u>=l?l>=m?(p=1,M=0,q=0,d=1,f=1,i=0):u>=m?(p=1,M=0,q=0,d=1,f=0,i=1):(p=0,M=0,q=1,d=1,f=0,i=1):l<m?(p=0,M=0,q=1,d=0,f=1,i=1):u<m?(p=0,M=1,q=0,d=0,f=1,i=1):(p=0,M=1,q=0,d=1,f=1,i=0);const _=u-p+G,E=l-M+G,X=m-q+G,$=u-d+2*G,H=l-f+2*G,j=m-i+2*G,z=u-1+3*G,N=l-1+3*G,I=m-1+3*G,F=R&255,a=T&255,U=D&255;let V=.6-u*u-l*l-m*m;if(V<0)w=0;else{const b=F+t[a+t[U]];V*=V,w=V*V*(e[b]*u+o[b]*l+s[b]*m)}let S=.6-_*_-E*E-X*X;if(S<0)g=0;else{const b=F+p+t[a+M+t[U+q]];S*=S,g=S*S*(e[b]*_+o[b]*E+s[b]*X)}let P=.6-$*$-H*H-j*j;if(P<0)x=0;else{const b=F+d+t[a+f+t[U+i]];P*=P,x=P*P*(e[b]*$+o[b]*H+s[b]*j)}let B=.6-z*z-N*N-I*I;if(B<0)v=0;else{const b=F+1+t[a+1+t[U+1]];B*=B,v=B*B*(e[b]*z+o[b]*N+s[b]*I)}return 32*(w+g+x+v)}}function nt(n){const e=new Uint8Array(512);for(let o=0;o<512/2;o++)e[o]=o;for(let o=0;o<512/2-1;o++){const s=o+~~(n()*(256-o)),y=e[o];e[o]=e[s],e[s]=y}for(let o=256;o<512;o++)e[o]=e[o-256];return e}function at(n){return function(){let t=n+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function J(n){let t=2166136261;for(let e=0;e<n.length;e++)t^=n.charCodeAt(e),t=Math.imul(t,16777619)>>>0;return t>>>0}function ct(){const n=new Date,t=String(n.getFullYear()),e=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0");return J(`${t}-${e}-${o}`)}function lt(){try{if(typeof window<"u"){const t=new URLSearchParams(window.location.search).get("seed");if(t!=null){const o=Number(t);return Number.isFinite(o)?o>>>0:J(t)}const e=window.__RANDOM_SEED;if(e!=null)return typeof e=="number"?e>>>0:J(String(e))}}catch(n){console.log(n)}return null}function ht(){const n=lt();if(n!=null)return n>>>0;try{return ct()>>>0}catch(t){console.log(t)}return Math.floor(Math.random()*4294967295)>>>0}class ft{rng;simplex2D;simplex3D;constructor(t){this.rng=at(t),this.simplex2D=st(this.rng),this.simplex3D=it(this.rng)}random(){return this.rng()}}ht();function ut(n,t,e,o,s,y,c,k){const r=y,w=k||{islandRadiusFactor:.4,transitionZoneFactor:.15,detailStartHeight:0,detailFullHeightFactor:.6,oceanDropMultiplier:1.5,underwaterEdgeThresholdFactor:.5},g=Math.sqrt(n*n+t*t),x=s*w.islandRadiusFactor,v=s*w.transitionZoneFactor;let C=1;if(g>x){const u=g-x,l=Math.min(u/v,1);C=1-l*l*(3-2*l)}let R=0;R+=c.simplex2D(n*e*r.veryLowFreq.freq+r.veryLowFreq.phaseX,t*e*r.veryLowFreq.freq+r.veryLowFreq.phaseZ)*o*r.veryLowFreq.weight,R+=c.simplex2D(n*e*r.lowFreq.freq+r.lowFreq.phaseX,t*e*r.lowFreq.freq+r.lowFreq.phaseZ)*o*r.lowFreq.weight;const T=w.detailStartHeight,D=T+o*w.detailFullHeightFactor;let h=(R-T)/(D-T);h=Math.max(0,Math.min(1,h));const L=h*h*(3-2*h);let A=0;A+=c.simplex2D(n*e*r.midFreq.freq+r.midFreq.phaseX,t*e*r.midFreq.freq+r.midFreq.phaseZ)*o*r.midFreq.weight,A+=c.simplex2D(n*e*r.highFreq.freq+r.highFreq.phaseX,t*e*r.highFreq.freq+r.highFreq.phaseZ)*o*r.highFreq.weight,A+=c.simplex2D(n*e*r.veryHighFreq.freq+r.veryHighFreq.phaseX,t*e*r.veryHighFreq.freq+r.veryHighFreq.phaseZ)*o*r.veryHighFreq.weight;let O=R+A*L;return O*=C,O-=(1-C)*(o*w.oceanDropMultiplier),O=Math.max(-o*w.oceanDropMultiplier,Math.min(o,O)),g>x+v*w.underwaterEdgeThresholdFactor&&(O=Math.min(O,-3)),O}function K(n){return[(n>>16&255)/255,(n>>8&255)/255,(n&255)/255]}function Z(n,t,e){return[n[0]+(t[0]-n[0])*e,n[1]+(t[1]-n[1])*e,n[2]+(t[2]-n[2])*e]}function dt(n){const{tx:t,tz:e,segments:o,tileSize:s,terrainParams:y,biomeColors:c,biomeHeightStops:k,terrainHeight:r,terrainScale:w,waterLevel:g,worldSize:x,seed:v,falloff:C}=n,R=new ft(v),T=o+1,D=T*T,h=new Float32Array(D),L=new Float32Array(D*3),A=t*s-s/2,O=e*s-s/2,u=K(c.submerged),l=K(c.low),m=K(c.mid),p=K(c.high),M=K(c.rock),q=K(c.peak),d=g,f=g+r*k.lowStop,i=g+r*k.midStop,_=g+r*k.highStop,E=g+r*k.rockStop,X=g+r*k.peakStop,$=r;let H=0;for(let j=0;j<=o;j++)for(let z=0;z<=o;z++){const N=A+z/o*s,I=O+j/o*s;let F=ut(N,I,w,r,x,y,R,C);h[H]=F;let a=[0,0,0];const U=R.simplex2D(N*.3,I*.3)*.5+.5,V=R.simplex2D(N*.5,I*.5)*.5+.5;if(F<d)a=u;else if(F<f){const S=Math.max(0,Math.min(1,(F-d)/(f-d)));a=Z(u,l,S)}else if(F<i){const S=Math.max(0,Math.min(1,(F-f)/(i-f)));a=Z(l,m,S)}else if(F<_){const S=Math.max(0,Math.min(1,(F-i)/(_-i)));a=Z(m,p,S)}else if(F<E){const S=Math.max(0,Math.min(1,(F-_)/(E-_))),P=Z(M,p,U*.3);a=Z(p,P,S)}else if(F<X)a=Z(M,p,U*.5);else{const S=Math.max(0,Math.min(1,(F-X)/($-X)));a=Z(M,q,S);const P=V*.08;a[0]=Math.min(1,a[0]+P),a[1]=Math.min(1,a[1]+P),a[2]=Math.min(1,a[2]+P)}L[H*3]=a[0],L[H*3+1]=a[1],L[H*3+2]=a[2],H++}return{heights:h,colors:L}}self.onmessage=n=>{const t=n.data;if(t.type==="generate"){const e=dt(t);self.postMessage({type:"chunk-ready",tx:t.tx,tz:t.tz,heights:e.heights,colors:e.colors},[e.heights.buffer,e.colors.buffer])}}})();
