(function(){"use strict";const $=Math.sqrt(3),ot=.5*($-1),W=(3-$)/6,st=1/3,G=1/6,H=o=>Math.floor(o)|0,tt=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),J=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function rt(o=Math.random){const t=nt(o),n=new Float64Array(t).map(i=>tt[i%12*2]),e=new Float64Array(t).map(i=>tt[i%12*2+1]);return function(g,p){let s=0,r=0,R=0;const d=(g+p)*ot,_=H(g+d),k=H(p+d),D=(_+k)*W,E=_-D,P=k-D,S=g-E,l=p-P;let A,x;S>l?(A=1,x=0):(A=0,x=1);const X=S-A+W,M=l-x+W,F=S-1+2*W,h=l-1+2*W,y=_&255,b=k&255;let m=.5-S*S-l*l;if(m>=0){const c=y+t[b],C=n[c],L=e[c];m*=m,s=m*m*(C*S+L*l)}let f=.5-X*X-M*M;if(f>=0){const c=y+A+t[b+x],C=n[c],L=e[c];f*=f,r=f*f*(C*X+L*M)}let u=.5-F*F-h*h;if(u>=0){const c=y+1+t[b+1],C=n[c],L=e[c];u*=u,R=u*u*(C*F+L*h)}return 70*(s+r+R)}}function it(o=Math.random){const t=nt(o),n=new Float64Array(t).map(g=>J[g%12*3]),e=new Float64Array(t).map(g=>J[g%12*3+1]),i=new Float64Array(t).map(g=>J[g%12*3+2]);return function(p,s,r){let R,d,_,k;const D=(p+s+r)*st,E=H(p+D),P=H(s+D),S=H(r+D),l=(E+P+S)*G,A=E-l,x=P-l,X=S-l,M=p-A,F=s-x,h=r-X;let y,b,m,f,u,c;M>=F?F>=h?(y=1,b=0,m=0,f=1,u=1,c=0):M>=h?(y=1,b=0,m=0,f=1,u=0,c=1):(y=0,b=0,m=1,f=1,u=0,c=1):F<h?(y=0,b=0,m=1,f=0,u=1,c=1):M<h?(y=0,b=1,m=0,f=0,u=1,c=1):(y=0,b=1,m=0,f=1,u=1,c=0);const C=M-y+G,L=F-b+G,Y=h-m+G,T=M-f+2*G,Z=F-u+2*G,N=h-c+2*G,z=M-1+3*G,I=F-1+3*G,q=h-1+3*G,a=E&255,V=P&255,K=S&255;let w=.6-M*M-F*F-h*h;if(w<0)R=0;else{const O=a+t[V+t[K]];w*=w,R=w*w*(n[O]*M+e[O]*F+i[O]*h)}let v=.6-C*C-L*L-Y*Y;if(v<0)d=0;else{const O=a+y+t[V+b+t[K+m]];v*=v,d=v*v*(n[O]*C+e[O]*L+i[O]*Y)}let B=.6-T*T-Z*Z-N*N;if(B<0)_=0;else{const O=a+f+t[V+u+t[K+c]];B*=B,_=B*B*(n[O]*T+e[O]*Z+i[O]*N)}let Q=.6-z*z-I*I-q*q;if(Q<0)k=0;else{const O=a+1+t[V+1+t[K+1]];Q*=Q,k=Q*Q*(n[O]*z+e[O]*I+i[O]*q)}return 32*(R+d+_+k)}}function nt(o){const n=new Uint8Array(512);for(let e=0;e<512/2;e++)n[e]=e;for(let e=0;e<512/2-1;e++){const i=e+~~(o()*(256-e)),g=n[e];n[e]=n[i],n[i]=g}for(let e=256;e<512;e++)n[e]=n[e-256];return n}function ct(o){return function(){let t=o+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function et(o){let t=2166136261;for(let n=0;n<o.length;n++)t^=o.charCodeAt(n),t=Math.imul(t,16777619)>>>0;return t>>>0}function at(){try{if(typeof window<"u"){const t=new URLSearchParams(window.location.search).get("seed");if(t!=null){const e=Number(t);return Number.isFinite(e)?e>>>0:et(t)}const n=window.__RANDOM_SEED;if(n!=null)return typeof n=="number"?n>>>0:et(String(n))}}catch(o){console.log(o)}return null}function lt(){const o=at();return o!=null?o>>>0:Math.floor(Math.random()*4294967295)>>>0}class ht{rng;simplex2D;simplex3D;constructor(t){this.rng=ct(t),this.simplex2D=rt(this.rng),this.simplex3D=it(this.rng)}random(){return this.rng()}}lt();function ft(o,t,n,e,i,g,p){const s=g;let r=0;const R=Math.sqrt(o*o+t*t),d=i*.4,_=i*.15;let k=1;if(R>d){const l=R-d,A=Math.min(l/_,1);k=1-A*A*(3-2*A)}r+=Math.sin(o*n*s.veryLowFreq.freq+s.veryLowFreq.phaseX)*Math.cos(t*n*s.veryLowFreq.freq+s.veryLowFreq.phaseZ)*e*.6,r+=Math.sin(o*n*s.lowFreq.freq+s.lowFreq.phaseX)*Math.cos(t*n*s.lowFreq.freq+s.lowFreq.phaseZ)*e*.35,r+=Math.sin(o*n*s.midFreq.freq+s.midFreq.phaseX)*Math.cos(t*n*s.midFreq.freq+s.midFreq.phaseZ)*e*.2,r+=Math.sin(o*n*s.highFreq.freq+s.highFreq.phaseX)*Math.cos(t*n*s.highFreq.freq+s.highFreq.phaseZ)*e*.1,r+=Math.sin(o*n*s.veryHighFreq.freq+s.veryHighFreq.phaseX)*Math.cos(t*n*s.veryHighFreq.freq+s.veryHighFreq.phaseZ)*e*.05,r*=k,r-=(1-k)*(e*1.5),r=Math.max(-e*1.5,Math.min(e,r));const D=.1,E=p.simplex2D(o*D,t*D),P=Math.max(0,r/e),S=P*P*e*.15;if(r+=E*S,r>e*.3){const l=p.simplex2D(o*.3,t*.3);r+=l*e*.05}return R>d+_*.5&&(r=Math.min(r,-3)),r}function U(o){return[(o>>16&255)/255,(o>>8&255)/255,(o&255)/255]}function j(o,t,n){return[o[0]+(t[0]-o[0])*n,o[1]+(t[1]-o[1])*n,o[2]+(t[2]-o[2])*n]}function ut(o){const{tx:t,tz:n,segments:e,tileSize:i,terrainParams:g,biomeColors:p,biomeHeightStops:s,terrainHeight:r,terrainScale:R,waterLevel:d,worldSize:_,seed:k}=o,D=new ht(k),E=e+1,P=E*E,S=new Float32Array(P),l=new Float32Array(P*3),A=t*i-i/2,x=n*i-i/2,X=U(p.submerged),M=U(p.low),F=U(p.mid),h=U(p.high),y=U(p.rock),b=U(p.peak),m=d,f=d+r*s.lowStop,u=d+r*s.midStop,c=d+r*s.highStop,C=d+r*s.rockStop,L=d+r*s.peakStop,Y=r;let T=0;for(let Z=0;Z<=e;Z++)for(let N=0;N<=e;N++){const z=A+N/e*i,I=x+Z/e*i;let q=ft(z,I,R,r,_,g,D);S[T]=q;let a=[0,0,0];const V=D.simplex2D(z*.3,I*.3)*.5+.5,K=D.simplex2D(z*.5,I*.5)*.5+.5;if(q<m)a=X;else if(q<f){const w=Math.max(0,Math.min(1,(q-m)/(f-m)));a=j(X,M,w)}else if(q<u){const w=Math.max(0,Math.min(1,(q-f)/(u-f)));a=j(M,F,w)}else if(q<c){const w=Math.max(0,Math.min(1,(q-u)/(c-u)));a=j(F,h,w)}else if(q<C){const w=Math.max(0,Math.min(1,(q-c)/(C-c))),v=j(y,h,V*.3);a=j(h,v,w)}else if(q<L)a=j(y,h,V*.5);else{const w=Math.max(0,Math.min(1,(q-L)/(Y-L)));a=j(y,b,w);const v=K*.08;a[0]=Math.min(1,a[0]+v),a[1]=Math.min(1,a[1]+v),a[2]=Math.min(1,a[2]+v)}l[T*3]=a[0],l[T*3+1]=a[1],l[T*3+2]=a[2],T++}return{heights:S,colors:l}}self.onmessage=o=>{const t=o.data;if(t.type==="generate"){const n=ut(t);self.postMessage({type:"chunk-ready",tx:t.tx,tz:t.tz,heights:n.heights,colors:n.colors},[n.heights.buffer,n.colors.buffer])}}})();
